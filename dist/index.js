(()=>{"use strict";var e=[,(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(2);const s=r(3);const o=class{constructor({ip:e,port:t}={}){if(!point||!e)throw new Error("open must have ip and port");this.client=null,this.isConnected=!1,this.isClose=!1,this.busHandle=null,this.transcoder=new n.default,this.overageBuffer="",this.open({ip:e,port:t})}setCallback(e){this.busHandle=e}send(e){"string"!=typeof e&&(e=JSON.stringify(e)),this.client&&this.client.write(this.transcoder.encode(e))}open({ip:e,port:t}){if(this.isClose=!1,this.client)return!1;const r=this.client=new s.Socket;r.connect(t,e,(e=>{this.isConnected=!0,this.busHandle&&this.busHandle("connect",e)})),r.on("data",(e=>{this.overageBuffer?this.overageBuffer=Buffer.concat([this.overageBuffer,e]):this.overageBuffer=e;let t=this.transcoder.getPackageLength(this.overageBuffer);for(;t.bufferLength;){this.overageBuffer=this.overageBuffer.slice(t.invalidByte);const e=10,r=6,n=this.overageBuffer.readUInt32LE(r);if(n===this.overageBuffer.slice(e,n+e).length){const t=this.overageBuffer.slice(0,n+e);this.overageBuffer=this.overageBuffer.slice(n+e);const r=this.transcoder.decode(t);this.busHandle&&this.busHandle("message",r)}t=this.transcoder.getPackageLength(this.overageBuffer)}})),r.on("close",(e=>{this.busHandle&&this.busHandle("close",e),this.isConnected=!1,this.client=null,this.open()})),r.on("error",(e=>{this.busHandle&&this.busHandle("error",e)}))}}},(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});const n=class{constructor(){this.packageHeaderLen=10,this.serialNumber=4210752250,this.packageSerialNumberLen=6,this.funcNumLen=2,this.bodyLen=4}encode(e,t){const r=Buffer.from(e),n=Buffer.alloc(this.packageHeaderLen);return n.writeUInt32LE(t||this.serialNumber),n.writeUInt16LE(34,4),n.writeUInt32LE(r.length,6),Buffer.concat([n,r])}decode(e){const t=e.slice(0,this.packageHeaderLen),r=e.slice(this.packageHeaderLen);return{serialNumber:t.readInt32LE(),funcCode:t.readUInt16LE(this.packageHeaderLen-this.packageSerialNumberLen),bodyLength:t.readUInt32LE(this.packageHeaderLen-this.bodyLen),body:r}}getPackageLength(e){let t=0;if(e.length>=10){let r=!0;for(;r;)t<=e.length-4?4210752250===e.readUInt32LE(t)?r=!1:t++:(t=e.length,r=!1);const n=e.slice(t);if(n.length<10)return{bufferLength:0,invalidByte:t};const s=n.readUInt32LE(6),o=n.slice(10,s+10).length;return 4210752250===e.readUInt32LE()&&o===s?{bufferLength:n.length,invalidByte:t}:{bufferLength:0,invalidByte:t}}return{bufferLength:0,invalidByte:t}}}},e=>{e.exports=require("net")},(e,t,r)=>{r.r(t),r.d(t,{stringify:()=>s,parse:()=>o,default:()=>i});class n{constructor(e){this.value=e}}function s(e,t){const r=Date.prototype.toJSON;Date.prototype.toJSON=function(){return{"\0dt":new n(+this)}};const s=JSON.stringify(e,((e,r)=>{if(!r)return r;if(e.startsWith("\0"))return r instanceof n?r.value:void 0;if(!t?.test(e)){if("number"==typeof r)return Number.isNaN(r)||!Number.isFinite(r)?{"\0num":new n(r+"")}:r;if("object"==typeof r){const e=Object.prototype.toString.call(r).slice(8,-1);switch(e){case"Error":return{"\0err":new n([r.name,r.message,r.stack])};case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Map":case"Set":return{"\0arr":new n([e,Array.from(r)])}}}return"function"==typeof r?{"\0fn":new n(r+"")}:r}}));return Date.prototype.toJSON=r,s}function o(e){return JSON.parse(e,((e,t)=>{if(t&&"object"==typeof t&&!Array.isArray(t))for(const[e,r]of function*(e){for(const t in e)e.hasOwnProperty(t)&&(yield[t,e[t]])}(t)){if(0===e.charCodeAt(0))switch(e.slice(1)){case"dt":return new Date(r);case"fn":{let e=r;const t=/^function (\w+)\(\) { \[native code\] }$/.exec(e);return t?self[t[1]]:new Function(`"use strict"\nreturn (${e})`)()}case"num":return+r;case"err":{const[e,t,n]=r,s=new self[e](t);return s.stack=n,s}case"arr":return new self[r[0]](r[1])}return t}return t}))}const i={parse:o,stringify:s}},(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});const n=class{constructor(){this.socket=null,this.closeConfig={resolve:null,closing:!1},this.serverData=null}init(e){if(this.socket)throw new Error("Has been initialized");const t=this.socket=new WebSocket(e);t.onopen=e=>{self.postMessage([{key:"wsConnectStatus",data:!0}])},t.onerror=e=>{},t.onclose=t=>{this.socket=null,this.closeConfig.closing?this.closeConfig.closing=!1:this.init(e)},t.onmessage=e=>{const t=JSON.parse(e.data||"");self.postMessage([t])}}send(e,t={}){const r=this.socket&&this.socket.readyState;if(1!==r)throw new Error(`连接异常code: ${r}`);{const e=JSON.stringify(t);this.socket.send(e)}}close(){this.closeConfig.closing=!0,this.socket.close(),this.socket=null}}}],t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{TCPClient:()=>e.default,Transcoder:()=>t.default,SaveJson:()=>s.default,WsWorkerEventHandler:()=>o.default});var e=r(1),t=r(2),s=r(4),o=r(5)})()})();